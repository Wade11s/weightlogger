# E2E 测试场景

本文档描述了 Weight Logger 应用的关键用户流程和端到端测试场景。

## 测试环境准备

### 前置条件
1. 应用已成功构建（macOS 或 Windows）
2. 测试数据文件准备（JSON/CSV）
3. 测试用户场景定义

### 测试数据

#### 测试用 JSON 文件
```json
[
  {"id": "1", "date": "2024-01-01", "weight": 75.0, "note": "初始记录", "created_at": "2024-01-01T10:00:00Z"},
  {"id": "2", "date": "2024-01-08", "weight": 74.5, "note": "", "created_at": "2024-01-08T10:00:00Z"},
  {"id": "3", "date": "2024-01-15", "weight": 74.0, "note": "运动后", "created_at": "2024-01-15T10:00:00Z"}
]
```

#### 测试用 CSV 文件
```csv
Date,Weight,Note
2024-01-01,75.0,初始记录
2024-01-08,74.5,
2024-01-15,74.0,运动后
```

## 核心用户流程测试

### 场景 1: 首次使用 - 添加体重记录

**步骤：**
1. 启动应用
2. 验证应用界面正确显示（侧边栏、概览页面）
3. 点击「快速记录」区域
4. 输入日期（今日）
5. 输入体重（例如 70.5）
6. 可选：填写备注（例如"早上空腹"）
7. 点击「添加记录」
8. 验证：显示"数据已自动保存"提示
9. 验证：概览页面显示当前体重

**预期结果：**
- 记录成功保存
- BMI 计算正确（如果设置了身高）
- 概览页面更新显示

---

### 场景 2: 设置个人资料和目标

**步骤：**
1. 点击侧边栏「目标」
2. 点击「个人资料」卡片
3. 输入身高（例如 170）
4. 选择性别（可选）
5. 点击「保存」
6. 点击「目标设定」卡片
7. 输入目标体重（例如 65）
8. 可选：设置目标日期
9. 点击「保存」
10. 验证：目标进度卡片显示

**预期结果：**
- 个人资料保存成功
- BMI 自动计算
- 目标进度显示正确
- 预计达成日期计算（基于历史数据）

---

### 场景 3: 查看和编辑历史记录

**步骤：**
1. 点击侧边栏「记录」
2. 验证日历视图显示
3. 点击已有记录的日期
4. 在弹出的对话框中修改体重
5. 点击「更新记录」
6. 验证：显示"数据已自动保存"提示
7. 验证：日历中的数据已更新

**预期结果：**
- 记录编辑成功
- 日历视图实时更新
- 体重变化趋势更新

---

### 场景 4: 删除记录

**步骤：**
1. 点击侧边栏「记录」
2. 点击要删除的记录
3. 点击「删除」按钮
4. 确认删除对话框
5. 验证：记录被删除
6. 验证：日历中该日期不再显示记录

**预期结果：**
- 记录成功删除
- 统计数据更新

---

### 场景 5: 查看统计图表

**步骤：**
1. 点击侧边栏「统计」
2. 验证体重趋势图显示
3. 点击「7天」按钮
4. 验证图表只显示最近 7 天数据
5. 点击「30天」按钮
6. 验证图表显示最近 30 天数据
7. 点击「全部」按钮
8. 验证图表显示所有数据
9. 鼠标悬停在图表数据点上
10. 验证：显示详细信息的 Tooltip

**预期结果：**
- 图表正确渲染
- 时间筛选功能正常
- Tooltip 交互正常
- 统计卡片显示（最高/最低/变化）

---

### 场景 6: 数据导出

**步骤：**
1. 点击侧边栏「设置」
2. 找到「数据导出」卡片
3. 点击「JSON」按钮
4. 选择保存位置
5. 验证：显示"数据已成功导出"提示
6. 验证：导出的 JSON 文件包含所有数据
7. 点击「CSV」按钮
8. 选择保存位置
9. 验证：导出的 CSV 文件格式正确

**预期结果：**
- JSON 导出成功
- CSV 导出成功
- 文件格式符合规范

---

### 场景 7: 数据导入（无冲突）

**步骤：**
1. 确保应用中有一些记录
2. 点击侧边栏「设置」
3. 找到「数据导入」卡片
4. 选择冲突策略：「保留两者」
5. 点击「JSON」按钮
6. 选择测试用的 JSON 文件
7. 验证：显示导入结果（成功/失败/跳过数量）
8. 验证：「记录」页面中数据已更新

**预期结果：**
- 导入成功
- 新记录添加到现有数据
- 统计更新

---

### 场景 8: 数据导入（有冲突 - 覆盖）

**步骤：**
1. 准备与现有记录有相同日期的测试文件
2. 点击侧边栏「设置」
3. 选择冲突策略：「覆盖现有」
4. 点击「JSON」或「CSV」按钮
5. 选择测试文件
6. 验证：同日期记录被覆盖
7. 验证：概览页面体重已更新

**预期结果：**
- 冲突记录被覆盖
- 数据同步更新

---

### 场景 9: 数据导入（有冲突 - 跳过）

**步骤：**
1. 准备与现有记录有相同日期的测试文件
2. 选择冲突策略：「跳过冲突」
3. 执行导入
4. 验证：冲突记录被跳过
5. 验证：其他新记录正常导入

**预期结果：**
- 冲突记录保持不变
- 非冲突记录正常导入

---

### 场景 10: 备份和恢复

**步骤：**
1. 添加一些记录
2. 点击侧边栏「设置」
3. 点击「创建完整备份」
4. 选择保存位置
5. 验证：备份文件创建成功
6. 删除一条记录
7. 点击「从备份恢复」
8. 选择刚才创建的备份文件
9. 确认恢复
10. 验证：删除的记录已恢复

**预期结果：**
- 备份创建成功
- 恢复功能正常
- 数据完全还原

---

### 场景 11: 主题切换

**步骤：**
1. 验证当前是浅色主题
2. 点击右上角主题切换按钮（月亮图标）
3. 验证：界面切换到深色主题
4. 验证：所有组件颜色正确（侧边栏、卡片、文字）
5. 验证：图表颜色适配
6. 再次点击主题切换按钮（太阳图标）
7. 验证：切回浅色主题

**预期结果：**
- 主题切换流畅
- 所有组件适配两种主题
- 主题设置持久化

---

### 场景 12: 边界值测试

**步骤：**
1. 尝试输入无效体重（10kg - 低于最小值）
2. 验证：显示验证错误
3. 尝试输入无效体重（350kg - 高于最大值）
4. 验证：显示验证错误
5. 输入有效体重（20kg - 最小边界值）
6. 验证：记录成功
7. 输入有效体重（300kg - 最大边界值）
8. 验证：记录成功

**预期结果：**
- 边界值验证正确
- 错误提示清晰
- 有效边界值可以正常保存

---

### 场景 13: 空状态处理

**步骤：**
1. 清空所有数据（删除所有记录）
2. 验证概览页面显示引导提示
3. 验证统计页面显示"暂无数据"
4. 验证目标页面显示"设置目标后查看进度"
5. 尝试导出数据
6. 验证：显示"暂无数据可导出"
7. 添加第一条记录
8. 验证：所有页面正常显示数据

**预期结果：**
- 空状态提示友好
- 不会出现崩溃或错误
- 添加数据后正常工作

---

### 场景 14: 大数据量性能测试

**步骤：**
1. 导入包含 100+ 条记录的测试文件
2. 验证：导入在合理时间内完成（< 5秒）
3. 验证：日历视图滚动流畅
4. 验证：统计图表渲染正常
5. 切换时间筛选（7天/30天/全部）
6. 验证：响应及时

**预期结果：**
- 大数据量下性能良好
- 无明显卡顿
- 所有功能正常

---

### 场景 15: 目标达成祝贺

**步骤：**
1. 设置目标体重（与当前接近）
2. 添加一条达到目标的记录
3. 刷新或切换页面
4. 验证：显示祝贺消息

**预期结果：**
- 目标达成时显示祝贺
- 提供设定新目标的选项

---

## 自动化测试建议

### 工具选择
- **Playwright**: 跨平台 E2E 测试
- **Spectron**: Electron/Tauri 专用
- **Detox**: React Native 测试（可参考）

### 测试框架结构建议

```
tests/
├── e2e/
│   ├── scenarios/
│   │   ├── first-time-user.test.ts
│   │   ├── data-import-export.test.ts
│   │   ├── theme-switching.test.ts
│   │   └── performance.test.ts
│   ├── fixtures/
│   │   ├── test-data.json
│   │   └── test-data.csv
│   └── helpers.ts
```

### 关键测试函数示例

```typescript
// 添加记录
async function addRecord(date: string, weight: number, note?: string) {
  await page.click('[data-testid="quick-add"]');
  await page.fill('#date-input', date);
  await page.fill('#weight-input', weight.toString());
  if (note) await page.fill('#note-input', note);
  await page.click('[data-testid="save-record"]');
}

// 导出数据
async function exportData(format: 'json' | 'csv') {
  await page.click(`[data-testid="export-${format}"]`);
  // 处理文件下载对话框
}

// 验证 Toast 通知
async function verifyToast(message: string) {
  await expect(page.locator('.toast')).toContainText(message);
}
```

---

## 测试报告模板

| 场景 | 状态 | 备注 |
|------|------|------|
| 场景 1: 首次使用添加记录 | ✅ / ❌ | |
| 场景 2: 设置个人资料和目标 | ✅ / ❌ | |
| 场景 3: 查看和编辑历史记录 | ✅ / ❌ | |
| 场景 4: 删除记录 | ✅ / ❌ | |
| 场景 5: 查看统计图表 | ✅ / ❌ | |
| 场景 6: 数据导出 | ✅ / ❌ | |
| 场景 7: 数据导入（无冲突） | ✅ / ❌ | |
| 场景 8: 数据导入（冲突-覆盖） | ✅ / ❌ | |
| 场景 9: 数据导入（冲突-跳过） | ✅ / ❌ | |
| 场景 10: 备份和恢复 | ✅ / ❌ | |
| 场景 11: 主题切换 | ✅ / ❌ | |
| 场景 12: 边界值测试 | ✅ / ❌ | |
| 场景 13: 空状态处理 | ✅ / ❌ | |
| 场景 14: 大数据量性能 | ✅ / ❌ | |
| 场景 15: 目标达成祝贺 | ✅ / ❌ | |

---

## 性能基准

| 操作 | 预期时间 | 测试结果 |
|------|----------|----------|
| 应用启动 | < 3 秒 | |
| 添加记录 | < 1 秒 | |
| 渲染日历视图（100条记录） | < 500ms | |
| 渲染图表（100条记录） | < 1 秒 | |
| 导入 100 条记录 | < 5 秒 | |
| 导出 100 条记录 | < 2 秒 | |
| 主题切换 | < 200ms | |
